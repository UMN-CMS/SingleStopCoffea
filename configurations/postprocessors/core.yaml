PostDefaults:
  style_set: "style.yaml"
  plot_configuration:
    cms_text: "Preliminary"
    image_type: ".png"
    cms_text_color: Black

# num_files: 400

all_oned: &all_oned
  - uncomp_0p67_mChi
  - comp_0p67_mChi
  - uncomp_0p67_mStop
  - comp_0p67_mStop
  - m14_m
  - m13_m
  - h_njet
  - HT
  - pt_1
  - pt_2

drop_sample_patterns: 

  - "*30to50*"
  - "*50to80*"
  # - "*80to120*"
  # - "*120to170*"
  # - "*170to300*"
  # - "*300to470*"
  # - "*470to600*"

  - "*50to100*"
  - "*100to200*"
  # - "*200to300*"
  # - "*300to500*"

Postprocessing:
  # - name: Simple 1D Plots
  #   action: Histogram1D
  #   histogram_names: 
  #       - uncomp_0p67_mChi
  #       - comp_0p67_mChi
  #       - uncomp_0p67_mStop
  #       - comp_0p67_mStop
  #       - m14_m
  #       - m13_m
  #       # - h_njet
  #       # - HT
  #       # - pt_1
  #       # - pt_2
  #   scale: linear
  #   plot_configuration:
  #     cms_text: "Preliminary\n{region_name}"
  #   input: 
  #     group_fields: {'dataset.era.name':'*', 'dataset.name':'*', 'region_name':'*'}
  #     pipeline:
  #       - select_axes_values: {"variation":"central"}
  #       - rebin: 2
  #       - title_format: "{dataset.title}"
  #   output_name: "postprocessing/plots/{dataset.era.name}/{region_name}/{dataset.name}/{histogram_name}"
  # 
  # - name: Simple 2D Plots
  #   action: Histogram2D
  #   histogram_names:
  #     - uncomp_0p67_m14_vs_mChiRatio
  #     - comp_0p67_m14_vs_mChiRatio
  #     # - uncomp_0p67_m14_vs_mChi
  #     # - comp_0p67_m14_vs_mChi
  #   input: 
  #     group_fields: {'dataset.name': '*', 'dataset.era.name': '*', 'region_name': '*'}
  #     pipeline:
  #       - select_axes_values: {"variation":"central"}
  #       - rebin: 3
  #       - title_format: "{dataset.title}"
  #   output_name: "postprocessing/plots/{dataset.era.name}/{region_name}/{dataset.name}/{histogram_name}"
  #   plot_configuration:
  #     cms_text_color: white

  # - name: Export
  #   action: ExportHists
  #   histogram_names:
  #     - uncomp_0p67_m14_vs_mChiRatio
  #     - comp_0p67_m14_vs_mChiRatio
  #   input: 
  #     group_fields: {'dataset.name': '*', 'dataset.era.name': '*', 'region_name': '*'}
  #     pipeline: []
  #   output_name: "postprocessing/export_hists/{dataset.name}/{region_name}/{histogram_name}.pklz4"

  # - name: yields
  #   action: DumpYields
  #   input:
  #     group_fields: {}
  #     pipeline: []
  # 
  #   output_name: "postprocessing/yields.csv"
  # 
  # - name: Cutflow
  #   action: PlotCutflow
  #   input:
  #     group_fields: {'dataset.era.name':'*', 'dataset.name':'*', 'region_name':'*'}
  #     pipeline: []
  #     
  #   # scale: log
  #   style_set:
  #     - style:
  #         plot_type: step
  # 
  #   output_name: "postprocessing/plots/{dataset.era.name}/{dataset.name}/{region_name}/{histogram_name}"
  # 
  # 
  # 


  # 
  # - name: MC 2D Plots
  #   action: Histogram2D
  #   histogram_names:
  #     - uncomp_0p67_m14_vs_mChiRatio
  #     - comp_0p67_m14_vs_mChiRatio
  #     - uncomp_0p67_m14_vs_mChi
  #     - comp_0p67_m14_vs_mChi
  #   to_process:
  #     region_name: "*"
  #     sample_name:
  #       - 'qcd*'
  #       - 'signal*'
  #       - 'data*'
  #       - 'tt*'
  #   grouping: 
  #     fields: ['dataset.name', 'dataset.era.name', 'region_name']
  #     axis_options: {variation: central, REST: Rebin2}
  #   output_name: "postprocessing/plots/{dataset.era.name}/{dataset.name}/{region_name}/{histogram_name}"
  #   plot_configuration:
  #     cms_text_color: white


  - name: Plot
    action: RatioPlot 
    histogram_names:
      - HT
      - pt_1
    normalize: True
    scale: log


    style_set:
      - pattern:
          dataset.name: 'data*'
        style:
          plottype: errorbar
          color: black
          linestyle: null
          marker: 'o'

      - pattern:
          dataset.name: 'qcd*'
        style:
          plottype: step
          color: "#5790fc"

    numerator: 
      group_fields: {'dataset.name': 'data*', 'dataset.era.name': '*', 'region_name': 'Control'}
      pipeline: 
        - select_axes_values: {"variation":"unweighted"}
        - title_format: "{dataset.title}"

    denominator: 
      group_fields: {'dataset.name': 'qcd*', 'dataset.era.name': '*', 'region_name': 'Control'}
      pipeline: 
        - select_axes_values: {"variation":"unweighted"}
        - title_format: "{dataset.title}"
    match_fields: ['dataset.era.name' ,'region_name']
    output_name: "postprocessing/plots/ratios/{dataset.era.name}/{dataset.name}/{region_name}/{histogram_name}"
