PostDefaults:
  style_set: "style.yaml"
  plot_configuration:
    cms_text: "Preliminary"
    image_type: ".png"
    cms_text_color: Black

drop_sample_patterns:  []
  # - "*50to100*"
  # - "*100to200*"

Postprocessing:
  - name: Plot
    action: RatioPlot 
    scale: log
    histogram_names:
      - HT
      - h_njet
      - m13_m
      - m14_m
  
    denominator: 
      group_fields: {'dataset.era.name': '*', 'region_name': '*', 'dataset.sample_type': 'MC'}
      pipeline: 
        - select_axes_values: {"variation": "central"}
        - merge_axis_names: [_HT]
        - title_format: "{dataset.title}"
        - slices: [[null,3000]]
    numerator: 
      group_fields: {'dataset.era.name': '*', 'region_name': '*', "dataset.sample_type": Data}
      pipeline: 
        - select_axes_values: {"variation": "central"}
        - merge_axis_names: [_HT]
        - title_format: "{dataset.title}"
        - slices: [[null,3000]]
      
    match_fields: ['dataset.era.name' ,'region_name']
    output_name: "postprocessing/with_eff/plots/{dataset.era.name}/{region_name}/central_noweight_{histogram_name}"

  - name: Plot
    action: RatioPlot 
    scale: log
    histogram_names:
      - HT
      - h_njet
      - m13_m
      - m14_m
  
    denominator: 
      group_fields: {'dataset.era.name': '*', 'region_name': 'Control', 'dataset.sample_type': 'MC'}
      pipeline: 
        - select_axes_values: {"variation": "only_trigger_weight"}
        - merge_axis_names: [_HT]
        - title_format: "{dataset.title}"
        - slices: [[null,3000]]
    numerator: 
      group_fields: {'dataset.era.name': '*', 'region_name': 'Control', "dataset.sample_type": Data}
      pipeline: 
        - select_axes_values: {"variation": "central"}
        - merge_axis_names: [_HT]
        - title_format: "{dataset.title}"
        - slices: [[null,3000]]
      
    match_fields: ['dataset.era.name' ,'region_name']
    output_name: "postprocessing/with_eff/plots/{dataset.era.name}/{region_name}/{region_name}_raw_{histogram_name}"
    
  - name: Plot
    action: RatioPlot 
    scale: log
    histogram_names:
      - HT
      - h_njet
      - m13_m
      - m14_m
  
    denominator: 
      group_fields: {'dataset.era.name': '*', 'region_name': 'Control', 'dataset.sample_type': 'MC'}
      pipeline: 
        - select_axes_values: {"variation": "only_btag_shape_sf"}
        - merge_axis_names: [_HT]
        - title_format: "{dataset.title}"
        - slices: [[null,3000]]
    numerator: 
      group_fields: {'dataset.era.name': '*', 'region_name': 'Control', "dataset.sample_type": Data}
      pipeline: 
        - select_axes_values: {"variation": "central"}
        - merge_axis_names: [_HT]
        - title_format: "{dataset.title}"
        - slices: [[null,3000]]
      
    match_fields: ['dataset.era.name' ,'region_name']
    output_name: "postprocessing/with_eff/plots/{dataset.era.name}/{region_name}/{region_name}_only_bsf_{histogram_name}"
  
  
  - name: Plot
    action: RatioPlot 
    scale: log
    histogram_names:
      - HT
      - h_njet
      - m13_m
      - m14_m
  
    numerator: 
      group_fields: {'dataset.era.name': '*', 'region_name': 'Control', 'dataset.sample_type': 'Data'}
      pipeline: 
        - select_axes_values: {"variation": "central"}
        - merge_axis_names: [_HT]
        - title_format: "{dataset.title}"
        - slices: [[null,3000]]
  
    denominator: 
      group_fields: {'dataset.era.name': '*', 'region_name': 'ControlNoBNN', "dataset.sample_type": MC}
      pipeline: 
        - projection_axes: [_HT]
          # unweighted_name: only_trigger_weight
          unweighted_name: unweighted
          other_name: only_btag_shape_sf
          target_name: central
        - merge_axis_names: [_HT]
        - select_axes_values: {"variation":"central"}
        - title_format: "{dataset.title}"
        - slices: [[null,3000]]
      
    match_fields: ['dataset.era.name']
    #,'region_name']
    output_name: "postprocessing/with_eff/plots/{dataset.era.name}/{region_name}/{region_name}_ht_reweighted_bsf_{dataset.era.name}_{histogram_name}"

  - name: Plot
    action: RatioPlot 
    scale: log
    histogram_names:
      - HT
      - h_njet
      - m13_m
      - m14_m
  
    numerator: 
      group_fields: {'dataset.era.name': '*', 'region_name': 'Control', 'dataset.sample_type': 'Data'}
      pipeline: 
        - select_axes_values: {"variation": "central"}
        - merge_axis_names: [_HT]
        - title_format: "{dataset.title}"
        - slices: [[null,3000]]
  
    denominator: 
      group_fields: {'dataset.era.name': '*', 'region_name': 'Control', "dataset.sample_type": MC}
      pipeline: 
        - projection_axes: [_HT]
          unweighted_name: only_trigger_weight
          # unweighted_name: unweighted
          other_name: only_btag_shape_sf
          target_name: central
        - merge_axis_names: [_HT]
        - select_axes_values: {"variation":"central"}
        - title_format: "{dataset.title}"
        - slices: [[null,3000]]
      
    match_fields: ['dataset.era.name']
    #,'region_name']
    output_name: "postprocessing/with_eff/plots/{dataset.era.name}/{region_name}/{region_name}_ht_reweighted_bsf_{dataset.era.name}_{histogram_name}"
  

  - name: Plot
    action: RatioPlot 
    scale: log
    histogram_names:
      - HT
      - h_njet
      - m13_m
      - m14_m
  
    numerator: 
      group_fields: {'dataset.era.name': '*', 'region_name': 'Control', 'dataset.sample_type': 'MC', 'dataset.name': "qcd*"}
      pipeline: 
        - select_axes_values: {"variation":"only_trigger_weight"}
        - merge_axis_names: [_HT]
        - title_format: "{dataset.title}"
        - slices: [[null,3000]]
  
    denominator: 
      group_fields: {'dataset.era.name': '*', 'region_name': 'ControlNoBNN', 'dataset.sample_type': 'MC', 'dataset.name': "qcd*"}
      pipeline: 
        # - projection_axes: [_HT]
        #   unweighted_name: only_trigger_weight
        #   # unweighted_name: unweighted
        #   other_name: only_btag_shape_sf
        #   target_name: central
        - merge_axis_names: [_HT]
        - select_axes_values: {"variation":"unweighted"}
        - title_format: "{dataset.title}"
        - slices: [[null,3000]]
      
    match_fields: ['dataset.era.name']
    #,'region_name']
    output_name: "postprocessing/with_eff/plots/bnn_comp/{dataset.era.name}/{region_name}/{region_name}_ht_reweighted_bsf_{dataset.era.name}_{histogram_name}"
  
