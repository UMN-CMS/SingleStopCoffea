# The name of analysis to be run
name: SingleStop

# Where to save the output of the analysis
output_dir: output

# Possible limit regions/signals over which the analysis should be run
LimitTo:
  regions: [Signal312]


# Samples and in which regions they should be processed
samples:
  #QCDInclusive2018: All
  signal_312_2000_1900: [Signal312, Control]
  #signal313: [Signal313, Control]
  #Data2018: [Control]
  #MuonData2018: [SingleMuon]

# Samples and in which regions they should be processed
general_config:
  # If `use_selection_as_category` is false, the selection as described in the region.preselecection and region.selection blocks is a pure filter
  # If `use_selection_as_category` is true, then instead for each selection, an axis is added to the final histogram, which indicates where it passed for failed
  # This is useful for generating N-1 plots
    use_selection_as_category: false
    location_priority_order: [".*(US|CH|FR).*", "eos"]
    #save_cutflow: true

    skimming:
      output: "root://blabla/SingleStop/"

    
    # If try skim path is provided, then when processing sample S in region R,
    # the program will first check if they is a directory
    # If such a directory exists, then all *.root files in this directory are considered to be the complete fileset for this sample and region
    use_skims_path: "root://blabla/SingleStop/"
    #try_skim_path: None


# You can use yaml anchors to reduce the amount of duplication
common_items:
    common_signal_histograms: &common_signal
      #- name: goodjet_ht
      - name: jet_kinematics
      #- name: chargino_reco
      - name: b_quark_kinematics
        config:
          - working_point: L
          - working_point: M
          - working_point: T
      #- name: nn_reco
      #  config:
      #    - network_path: network1
      #    - network_path: network2
      #    - network_path: network3
      #- name: mc_hists
      #  sample_spec: {sample_type: MC}

    common_objects: &common_objects
      - name: core_objects


common_weights: &common_weights
  - name: L1_prefiring_sf
    sample_spec:
      eras: ["2016", "2017", "2018"]
      sample_type: MC
    config:
      variations: All

  - name: pileup_scale_factor
    sample_spec:
      sample_type: MC
    config:
      variations: All

# A region has a name, followed by description of what modules should be run
# for each stage of the analysis: preselection, object_creation, selection, categorization, and histogram production for the given region.
# Additionally, a module may also have a `sample_spec` option, which limits which samples it applies to, ie only make gen-level hists for MC.
# Weighting information is defined in the weights nodes, described below.
regions:
#  - name: Signal313
#    forbid_data: true
#    objects: *common_objects
#    preselection:
#      - name: selection_hlt
#    selection:
#      - name: general_selection
#      - name: 313_selection
#    categories:
#      - njets_category:
#    histograms: *common_signal
#    weights:
#      - <<: *common_weights
#      - name: btag_scale_factors
#        config:
#            working_points: [T]

          
  - name: Signal312
    forbid_data: True
    objects: *common_objects
    preselection:
      - name: signal_hlt
    selection:
      - name: general_selection
      - name: partial_signal312_selection
    histograms: *common_signal
    weights:
      - <<: *common_weights
      #- name: btagging_sf
      #  config:
      #      working_points: [M,T]

  - name: Control
    objects: *common_objects
    preselection:
      - name: signal_hlt
    selection:
      - name: general_selection
      - name: partial_cr_selection
    histograms:
      - name: jet_kinematics
    weights:
      - <<: *common_weights
      #- name: btagging_sf
      #  config:
      #      working_points: [L]

#  - name: SingleMuon
#    use_region: false
#    objects: *common_objects
#    preselection:
#      - name: single_muon_trigger
#    preselection_histograms:
#      - name: preselection_ht
#    selection:
#      - name: selection_hlt
#    histograms:
#      - name: goodjet_ht
#    weights:
#      - <<: *common_weights

# Weights described which weights and variations should be applied to which samples and regions
# Weights are applied immediately after selection 

PostProcessing:
  - name: Plots
    configuration:
      output: "plots/{region_name}/{sample_name}/{plot_name}_{variation}"
      image_type: pdf
      cms_tag: Preliminary
    outputs:
      cutflow_table:
        - samples: All
          regions: All
    histograms:
      - name: HT
        samples: All
        regions: All
  
      - name: n_medb
        type: basic
        save_name: medium_bjets
        normalize: True
        desk: Number of medium b jets
        samples: All
        regions: [Signal312,Signal313]
  
      - name: n_looseb
        type: basic
        normalize: False
        scale: log
        desc: Number of loose b jets
        samples: All
        regions: [Signal312,Signal313]
  
      - name: m24_m
        type: basic
        mode: stacked
        desk: Number of loose b jets
        samples: All
        regions: [Signal312,Signal313]
  
      - name: m24_m
        type: basic
        mode: split
        desk: Number of loose b jets
        samples: All
        regions: [Signal312,Signal313]
  
      - type: trigger_efficiency
        num: preselection_HT
        den: HT
        desk: Number of loose b jets
        samples: AllData
        regions: SingleMuon
  
      - type: weight_comparison
        name: HT
        weight: btag_scale_factors
        show_variations: [up, down]
        samples: All
  
      - type: weight_comparison
        name: njets
        weight: btag_scale_factors
        show_variations: [up, down]
        samples: All
  
  - name: regression_inputs
    output_dir: regression_inputs
    gp_regressorNN:
      output_dir: "{region}/{sample_name}/"
      histograms:
        - m14_vs_m13
        - m14_vs_NN1
        - m14_vs_NN2
        - m14_vs_NN3

      



  

  
    
    
